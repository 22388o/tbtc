\documentclass{article}
\usepackage[utf8]{inputenc}

\usepackage[margin=1in]{geometry}
\usepackage{tikz}
\usepackage[colorlinks=true]{hyperref}
\usepackage{varwidth}
\usepackage{rotating}
\usepackage{tikz-uml}
\usepackage{xstring} % for tikz-uml
\usepackage{pgfopts} % for tikz-uml
\usepackage[english]{babel} % for tikz-uml

\usetikzlibrary{positioning}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.symbols}
\usetikzlibrary{calc}
\usetikzlibrary{chains}
\usetikzlibrary{fit}

\tikzset{
  start state/.style={draw,ellipse,text width=0},
  state/.style={draw,ellipse,align=flush center,text width=2.5cm},
  box state/.style={draw,rectangle,align=flush center,text width=2.5cm,inner sep=7pt},
  leaf state/.style={box state,rounded corners=12pt},
  decision/.style={draw,rectangle,align=flush center},
  thread/.style={draw,signal,signal to=east,fill=white},
  % Nested states and decisions use doubled borders to indicate
  % that you have to reference a different diagram.
  nested state/.style={draw,ellipse,double,align=flush center,text width=2.5cm},
  nested decision/.style={draw,rectangle,double,align=flush center},
  % Chain states and decisions use dashed borders to indicate
  % that you have to interact with the chain.
  chain state/.style={draw,ellipse,dashed,align=flush center,text width=2.5cm},
  chain decision/.style={draw,rectangle,dashed,align=flush center},
  chain transition/.style={draw,dashed},
  % Nested chain decisions combine nested and chain styles to
  % indicate a reference to a different diagram for a state that
  % depends on chain interaction.
  nested chain decision/.style={draw,rectangle,double,dashed,align=flush center},
  % Set default arrow style to stealth.
  >=Stealth
}

\begin{document}

Below are state diagrams elaborating on the various pieces of a Keep node. Note
that Keep nodes actually run multiple processes in parallel, for participation
in the random beacon threshold relay as well as for participating in the Keep
network. The startup diagram indicates this and links to the subprocess state
diagrams.

First, however, a legend:

\vspace{0.5cm}

\begin{center}
  \tikz{
      \node[thread] (thread) {A thread};

      \node[nested state] (nested state) [below=1cm of thread] {A nested state};
      \node[state] [left=1cm of nested state](state) {A regular state};
      \node[chain state] (chain state) [right=1cm of nested state] {A state dependent on the chain};

      \node[nested decision] (nested decision) [below=1cm of nested state] {A nested decision};
      \node[decision] (decision) [left=1cm of nested decision] {A decision};
      \node[chain decision,text width=2cm] (chain decision) [right=1cm of nested decision] {A decision dependent on the chain};

      \draw [<-] (-4.5,0.25) -- node [centered,text width=2cm,align=center] {state\\transition} (-2.5,0.25);
      \draw [->,dashed] (2,0.25) -- node [centered,text width=4cm,align=center] {chain-dependent\\state transition} (5.25,0.25)
  }
\end{center}

\vspace{0.5cm}

Nested states and decisions should link to the nested diagrams that indicate
what is going on within these states or decisions.

\vspace{0.5cm}

\begin{figure}
  \centering
  \input{img-src/initiate-deposit.tikz}

  \caption{\label{fig:deposit-initiation}Deposit initiation.}
\end{figure}

% Flush floats before a rotated page.
\clearpage

\begin{sidewaysfigure}
  \global\pdfpageattr\expandafter{\the\pdfpageattr/Rotate 90}
  \centering
  \input{img-src/signing-group-creation.tikz}

  \caption{\label{fig:signing-group-creation}Signing group creation.}
\end{sidewaysfigure}

% Flush floats before a rotated page.
\clearpage

\begin{sidewaysfigure}
  \global\pdfpageattr\expandafter{\the\pdfpageattr/Rotate 90}
  \centering
  \input{img-src/deposit-state-machine.tikz}

  \caption{\label{fig:deposit-state-machine}Deposit state machine.}
\end{sidewaysfigure}

\end{document}
